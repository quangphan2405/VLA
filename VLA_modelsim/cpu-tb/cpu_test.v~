module cpu_test;

   reg CLK, RST;
   wire HALT;

   cpu cpu_inst
     (.CLK  ( CLK  ),
      .RST  ( RST  ),
      .HALT ( HALT )
      );

   task display_header;
      begin
	 $display("Input a value for testcase:");
      end
   endtask // deposit

   task run
     ( input [7:0] value,
       reg [9*8:1] testfile
       );
      begin
	 testfile = { "PROG", 8'h30+value, ".txt" };
	 $readmemb (testfile, top.cpu_inst.mem );
	 @(negedge CLK) RST = 1;
	 @(negedge CLK) RST = 0;
      end
   endtask // run

   task display_result;
      reg [4:0] expected_pc;
      begin
	 case ( run.value )
	   1: expected_pc <= 5'h17;
	   2: expected_pc <= 5'h10;
	   3: expected_pc <= 5'h0C;
	 endcase // case ( run.value )
	 $display("Halted at address %h", cpu_inst.pc);
	 $display("Expected to halt at address %h", expected_pc);
	 $display("TEST %s", (cpu_inst.pc === expected_pc)?"PASSED":"FAILED");
      end
   endtask // display_result

   

   

	 
   
